# ==============================================================================
# EcoBridge 核心配置文件 (Java 高性能版)
# ==============================================================================

# ------------------------------------------------------------------------------
# 数据库设置 (Database)
# ------------------------------------------------------------------------------
database:
  # 数据库连接地址
  # 强烈建议使用 MariaDB 驱动以获得最佳批量写入性能
  # 格式: jdbc:mariadb://<主机>:<端口>/<数据库名>
  url: "jdbc:mariadb://localhost:3306/ecobridge"
  
  # 数据库用户名
  user: "root"
  
  # 数据库密码
  password: "password"

# ------------------------------------------------------------------------------
# 经济对接设置 (Economy)
# ------------------------------------------------------------------------------
economy-settings:
  # CoinsEngine 中的货币 ID
  # 插件将监控此货币的流通量并据此计算通胀率
  currency-id: "ellan_gold"

# ------------------------------------------------------------------------------
# PID 控制器参数 (PID Controller)
# 核心算法：用于根据商品的净销量自动调节价格系数 (Lambda)
# 警告：非专业人士请勿随意修改 KP/KI/KD 参数
# ------------------------------------------------------------------------------
pid-controller:
  default:
    # 目标净销量 (买入量 - 卖出量)
    # 如果 净销量 > 目标值，价格系数上升 (商品太热销，涨价抑制)
    # 如果 净销量 < 目标值，价格系数下降 (商品滞销，降价促销)
    target-volume: 1000.0
    
    # 基础价格波动率 (Lambda 初始值)
    # 代表价格变化的基准速率，例如 0.002 代表每次 tick 倾向于变动 0.2%
    base-lambda: 0.002
    
    # --- PID 三项参数 ---
    # 比例项 (Proportional): 对当前误差的反应速度。值越大，价格对销量变化反应越剧烈。
    kp: 0.00001
    
    # 积分项 (Integral): 对过去累积误差的修正。用于消除稳态误差，防止价格卡在某个不合理的位置。
    ki: 0.000001
    
    # 微分项 (Derivative): 对未来趋势的预测。用于抑制过冲，防止价格在目标值上下剧烈震荡。
    kd: 0.00005
    
    # --- 安全限制 ---
    # 最小价格系数 (防止价格完全不动)
    min-lambda: 0.0005
    # 最大价格系数 (防止价格瞬间暴涨暴跌)
    max-lambda: 0.01
    
    # 记忆衰减因子 (Tau，单位：天)
    # 控制积分项遗忘历史数据的速度。0.6 表示大约 0.6 天(约14小时)前的交易数据权重会大幅衰减。
    memory-tau: 0.6
    
    # 分段阈值 (可选功能)
    # 当销量超过此值时，可以使用另一套 PID 参数 (目前代码中使用统一参数，此项作为预留)
    split-volume: 800

# ------------------------------------------------------------------------------
# 市场波动 (Market Flux)
# 模拟市场的随机性，防止价格完全线性可预测
# ------------------------------------------------------------------------------
market-flux:
  # 正常波动范围 (例如 0.05 代表 ±5% 的随机波动)
  normal-range: 0.05
  
  # 市场大事件触发概率 (0.0 - 1.0)
  # 每小时判定一次，0.1 代表有 10% 的概率触发大事件
  event-chance: 0.1
  
  # 大事件期间的波动范围 (例如 ±30%)
  event-range: 0.3
  
  # 通胀权重
  # 全服通胀率对市场波动的影响权重。0.3 表示通胀率的 30% 会叠加到波动中。
  inflation-weight: 0.3

# ------------------------------------------------------------------------------
# 个人因子 (Personal Factors)
# 针对不同玩家的个性化价格调整
# ------------------------------------------------------------------------------
personal-factor:
  # 个人价格系数的最小值 (防止出现负数或 0 导致白送/倒贴)
  min-factor: 0.5
  
  # 富人税设置 (针对高资产玩家提高售价)
  rich:
    # 模式: DYNAMIC (基于全服分位数动态计算) 或 STATIC (固定金额)
    mode: "DYNAMIC"
    
    # 动态模式：定义全服前百分之多少的玩家算作“富人” (0.15 = 前 15%)
    percentile: 0.15
    
    # 计算富人税的最低资产门槛 (资产低于此值不参与计算)
    min-threshold: 100000.0
    
    # 静态模式：固定的富人判定金额
    fixed-threshold: 100000.0
    
    # 最大税率加成 (例如 0.1 代表最多加价 10%)
    max-tax: 0.1
    
    # 触发动态计算所需的最小样本数 (全服至少有几名玩家有钱)
    min-rich-count: 5

  # 老玩家福利 (针对在线时长长的玩家给予折扣)
  veteran:
    # 达到最大折扣所需的在线时长 (单位：小时)
    threshold-hours: 100
    
    # 最大折扣力度 (例如 0.05 代表最多打 95 折)
    max-discount: 0.05

# ------------------------------------------------------------------------------
# 活跃度因子 (Activity)
# 根据服务器负载和人气调整经济
# ------------------------------------------------------------------------------
activity:
  # 基础活跃度系数
  base: 1.0
  
  # 每位在线玩家增加的活跃度 (0.001 = 每人增加 0.1%)
  player-impact: 0.001
  
  # TPS 保护阈值
  # 当服务器 TPS 低于此值时，开始触发交易惩罚(涨价)，抑制高频交易机器
  tps-limit: 18.0
  
  # TPS 惩罚权重 (TPS 每降低 1 点增加的价格系数)
  tps-weight: 0.05

# ------------------------------------------------------------------------------
# 节假日设置 (Holidays)
# 自动从 API 获取节假日信息并调整价格
# ------------------------------------------------------------------------------
holidays:
  # 节假日数据 API (需返回特定 JSON 格式)
  api-url: "https://holiday.ailcc.com/api/holiday/allyear/"
  
  # 不同日期类型的价格倍率
  multipliers:
    # 0: 工作日 (平价)
    workday: 1.0
    # 1: 周末 (小幅涨价/活跃)
    weekend: 1.1
    # 2: 法定节假日 (大幅涨价/活跃)
    holiday: 1.5
    # 3: 调休 (稍微涨价)
    compensation: 1.2
    # 4: 其他
    other: 0.9