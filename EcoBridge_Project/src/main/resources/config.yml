# EcoBridge - 生产级配置
# Java 25 SIMD + FFM + VirtualThreads

# ==================== 数据库配置 ====================
database:
  # MariaDB/MySQL 连接 (推荐 MariaDB 10.6+)
  url: "jdbc:mariadb://localhost:3306/ecobridge?useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&serverTimezone=UTC"
  user: "root"
  password: "your_password_here"
  
  # HikariCP 连接池
  pool:
    maximum-size: 16          # 最大连接数 (建议 = CPU 核心数)
    minimum-idle: 4           # 最小空闲连接
    connection-timeout: 10000 # 连接超时 (ms)
    idle-timeout: 300000      # 空闲超时 (ms)
    max-lifetime: 1800000     # 连接最大存活时间 (ms)

# ==================== 经济系统配置 ====================
economy-settings:
  # CoinsEngine 货币 ID
  currency-id: "ellan_gold"
  
  # 富人门槛计算
  threshold:
    min-value: 100000.0       # 最低门槛
    percentile: 0.15          # 取前 15% 玩家的最低值
    
  # 通胀系数
  inflation:
    weight: 0.3               # 通胀权重 (0-1)
    update-interval: 36000    # 更新间隔 (ticks, 30分钟)

# ==================== 个人系数配置 ====================
personal-factor:
  min-factor: 0.5             # 最低倍率
  
  # 富人税 (余额超过门槛时增加倍率)
  rich:
    max-tax: 0.1              # 最大税率
    log-multiplier: 0.01      # 对数系数
    
  # 老玩家折扣
  veteran:
    max-discount: 0.05        # 最大折扣
    threshold-hours: 100      # 资深玩家小时数

# ==================== 市场波动配置 ====================
market-flux:
  normal-range: 0.05          # 正常波动范围 (±5%)
  event-range: 0.3            # 事件波动范围 (±30%)
  event-chance: 0.1           # 事件发生概率 (10%)
  update-interval: 6000       # 更新间隔 (ticks, 5分钟)

# ==================== 活跃度系数 ====================
activity:
  base: 1.0                   # 基础系数
  player-impact: 0.001        # 每个在线玩家的影响
  tps-limit: 18.0             # TPS 阈值
  tps-weight: 0.05            # TPS 惩罚权重
  update-interval: 1200       # 更新间隔 (ticks, 1分钟)

# ==================== 节假日系数 ====================
holidays:
  # API 配置
  api-url: "https://api.apihubs.cn/holiday/get"
  cache-duration: 86400000    # 缓存时间 (ms, 24小时)
  
  # 倍率配置
  multipliers:
    workday: 1.0              # 工作日
    weekend: 1.1              # 周末
    holiday: 1.5              # 法定节假日
    compensation: 1.2         # 调休补班
    other: 0.9                # 其他

# ==================== PID 控制器配置 ====================
pid-controller:
  # SIMD 优化
  simd-enabled: true
  vector-species: "PREFERRED" # PREFERRED / MAX / 256 / 512
  
  # 并发配置
  segment-count: 16           # 分段数 (建议 = CPU 核心数)
  segment-capacity: 8192      # 每段容量
  
  # PID 参数
  target-volume: 1000.0       # 目标交易量
  base-lambda: 0.002          # 基础价格系数
  kp: 0.00001                 # 比例系数
  ki: 0.000001                # 积分系数
  kd: 0.00005                 # 微分系数
  kp-neg-factor: 0.6          # 负误差 P 系数衰减
  tau-inv: 0.00001929         # 积分衰减系数
  deadband: 0.02              # 死区 (目标的 2%)
  
  # 限幅
  integral-max: 30000.0       # 积分上限
  integral-min: -30000.0      # 积分下限
  lambda-max: 0.01            # 价格系数上限
  lambda-min: 0.0005          # 价格系数下限
  
  # 刷新配置
  flush-interval: 1200        # 刷新间隔 (ticks, 1分钟)
  batch-size: 1000            # 批量大小

# ==================== 性能优化配置 ====================
performance:
  # VirtualThread 配置
  virtual-threads: true       # 启用虚拟线程
  
  # 内存优化
  memory-warmup: true         # 启动时预热内存
  gc-friendly: true           # GC 友好模式 (复用缓冲)
  
  # 调试选项
  debug-perf: false           # 性能日志
  debug-db: false             # 数据库日志
  debug-simd: false           # SIMD 日志

# ==================== 调度器配置 ====================
schedulers:
  # 主计算循环 (数据收集 + PID 计算)
  main-loop:
    initial-delay: 1200       # 初始延迟 (ticks, 1分钟)
    period: 1200              # 周期 (ticks, 1分钟)
    
  # 经济指标更新
  economy-update:
    initial-delay: 100        # 初始延迟 (ticks, 5秒)
    period: 36000             # 周期 (ticks, 30分钟)
    
  # 市场波动更新
  market-flux-update:
    initial-delay: 20         # 初始延迟 (ticks, 1秒)
    period: 6000              # 周期 (ticks, 5分钟)
    
  # 节假日缓存更新
  holiday-update:
    initial-delay: 20         # 初始延迟 (ticks, 1秒)
    period: 6000              # 周期 (ticks, 5分钟)

# ==================== 监控配置 ====================
monitoring:
  enabled: true               # 启用监控
  log-interval: 300           # 日志间隔 (秒)
  
  # 指标收集
  metrics:
    - pid-calculations        # PID 计算次数
    - simd-ratio              # SIMD 使用率
    - cache-hit-rate          # 缓存命中率
    - db-batch-size           # 数据库批量大小
    - memory-usage            # 内存使用
    - tps                     # 服务器 TPS

# ==================== 兼容性配置 ====================
compatibility:
  # 插件兼容
  ultimateshop: true
  placeholderapi: true
  coinsengine: true
  
  # 降级策略
  fallback-on-error: true     # 错误时降级到标量计算
  safe-mode: false            # 安全模式 (禁用所有优化)